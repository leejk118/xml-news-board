# XML-NEWS-BOARD PROJECT

## setup
### Laravel project 설치
* `composer create-project --prefer-dist laravel/larvel xml-news-board`
* `php artisan key:generate --ansi`

### Github 연동
* Github에 repository 생성
* `git init`
* `git add .`
* `git commit -m "create laravel project"`
* `git remote add origin https://github.com/leejk118/xml-news-board.git`
* `git push -u origin master`

### Nginx 연동
참고 : https://medium.com/@koswarabilly/laravel-with-nginx-installation-to-set-up-94eae92e2541
* nginx-1.19.0/conf/nginx.conf
    ```
          server {
              listen       7000;
              server_name  localhost;
              root xml-news-board/public/;
      
              location / {
                index  index.html index.htm index.php;
                try_files $uri $uri/ /index.php?$query_string;
              }

              location ~ \.php$ {
                try_files $uri /index.php = 404;
                fastcgi_pass  127.0.0.1:9000;
                fastcgi_index index.php;
                fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
                include fastcgi_params;
              }
     ```
* 프로젝트 실행
    * php7 디렉토리에서 `php-cgi.exe -b 127.0.0.1:9000` 실행
    * nginx 디렉토리에서 `start nginx`
    * 브라우저에서 127.0.0.1:7000 접속해서 확인
        > 실행파일 예시
        ```shell script
          @echo on
          cd c:/nginx-1.19.0/nginx-1.19.0
          start nginx
          cd c:/nginx-1.19.0/nginx-1.19.0/php7 
          php-cgi.exe -b 127.0.0.1:9000
          pause
        ```
    
### MySQL 연동
* .env  파일 설정
    ```
    DB_HOST=127.0.0.1 
    DB_DATABASE=myapp
    DB_USERNAME=jklee
    DB_PASSWORD='{password}'
    ```
- 데이터베이스 만들기
    - 관리자 계정으로 MySQL 접속
        - `mysql -uroot -p`
        - 비밀번호 입력 (MySQL 설치 시 생성한 비밀번호)
    - DB 생성
        - `CREATE DATABASE mydb;`
        - `CREATE USER 'jklee' IDENTIFIED BY '{password}';`
        - `GRANT ALL PRIVILEGES ON mydb.* TO 'jklee';`
        - `FLUSH PRIVILEGES;`
        - `quit`
    - 사용자 계정으로 접속 확인
        - `mysql -ujklee -p`
        - `use mydb`
        
- 마이그레이션 만들기
    - `php artisan make:migration create_articles_table --create=articles`
    - TIMESTAMP_create_articles_table.php
        ```php 
          public function up(){
              Schema::create('articles', function(Blueprint $table){
                    $table->id();
                    $table->string('title');
                    $table->string('subtitle')->nullable();
                    $table->string('content', 10000);
                    $table->date('send_date');
                    $table->string('new_link');
                    $table->timestamps();
              });    
          }   
        ```
    - 마이그레이션 실행
        - `php artisan migrate`
    - 실행 결과 확인
        - `mysql -ujklee -p;`
        - `use mydb;`
        - `DESCRIBE articles;`
    - 롤백
        - `php artisan migrate:rollback`

## XML 데이터 파싱
- 배치 파일 생성
    - `php artisan make:command MakeNews`
        - App\Console\Commands 디렉토리에 생성
    - `php artisan list` 명령 추가된 것 확인
    - MakeNews.php
        ```php 
           protected $signature = `command:make-news`;
        ```
    - `php artisan command:make-news` 실행 시 MakeNews.php의 handle() 메서드가 실행
    
- Article 모델 생성
    - `php artisan make:model Article`
    - fillable 설정
        - ```php 
          protected $fillable = ['title', 'subtitle', 'content', 'send_date', 'news_link'];
          ```
- 정규표현식 사용
    - 연합뉴스 XML의 TaggedBody에서 YNAPHOTO 태그를 이미지 태그로 치환
    

## Article 게시판 생성
-  RESTful 리소스 컨트롤러 생성
    - 컨트롤러 생성
        - `php artisan make:controller ArticlesController --resource`
    - web.php
        ```php
          Route::resource('articles', 'ArticlesController');
        ```
    - 라우트 목록 생성 확인
        - `php artisan route:list`

- 부트스트랩 적용
    - `composer require laravel/ui`
    - `php artisan ui bootstrap --auth`
    - `npm install && npm run dev`
    
- Article 뷰 생성
    - resources/views/articles/index.blade.php
        ```php 
      @extends('layouts.app')
      
      @section('content')
          <div class="container">
              <h1>News</h1>
              <hr>
              <ul>
                  @foreach($articles as $article)
                      <li>
                          {{ $article->title }}
                      </li>
                  @endforeach
              </ul>
      
              @if($articles->count())
                  <div class="text-center">
                      {!! $articles->render() !!}
                  </div>
              @endif
          </div>
      @stop

           
        ```

    - ArticlesController.php
        ```php 
      public function index()
      {
          $articles = \App\Article::latest()->paginate(10);
  
          return view('article.index', compact('articles'));
      }
        ```                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                
        > 커스텀 페이징 추후 구현 예정

- 게시글 조회기능
    - ArticlesController.php
        ```php 
      public function show($id)
      {
          $article = \App\Article::find($id);
  
          return view('articles.show', compact('article'));
      }
        ```
      
    - show.blade.php
        ```php 
        @extends('layouts.app')
        
        @section('content')
            <div class="container">
                <h1>{{ $article->title }}</h1>
                <hr>
                <h3>{{ $article->subtitle }}</h3>
                <p>작성일 : {{ $article->send_date }}</p>
                <p>원본링크 : <a href="{{ $article->news_link }}" target="_blank">{{ $article->news_link }}</a></p>
                <br><br>
                {!!  $article->content  !!}
            </div>
        @stop
        ```
      
    - index.blade.php
      ```php 
      <table>
          <tr>
              <th>기사 제목</th>
              <th>등록일</th>
              <th>조회수 (예정)</th>
          </tr>
          @foreach($articles as $article)
              <tr>
                  <td>
                      <a href="articles/{{ $article->id }}">
                          (미리보기)
                          {{ $article->title }}
                      </a>
                  </td>
                  <td>
                      {{ $article->send_date }}
                  </td>
              </tr>
          @endforeach
      </table>  
      ```
    
    
